<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Morph - 现代代码美化器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .code-font { font-family: 'Fira Code', monospace; }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">

    <!-- 顶部标题 -->
    <div class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-slate-900 tracking-tight">AI Code Morph</h1>
        <p class="text-slate-500 mt-2 text-sm">基于 DeepSeek 的智能实时代码格式化工具</p>
    </div>

    <!-- 主卡片容器 -->
    <div class="w-full max-w-6xl glass-card rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]">
        
        <!-- 左侧：输入区 -->
        <div class="flex-1 p-6 border-r border-slate-100 flex flex-col">
            <div class="flex items-center justify-between mb-4">
                <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">原始代码</span>
                <span class="px-2 py-1 text-[10px] bg-slate-100 text-slate-500 rounded uppercase font-bold">Input</span>
            </div>
            <textarea id="inputCode" 
                class="flex-1 w-full p-4 bg-transparent border-none focus:ring-0 resize-none code-font text-sm text-slate-700 outline-none"
                placeholder="在此粘贴凌乱的代码..."></textarea>
        </div>

        <!-- 右侧：输出区 -->
        <div class="flex-1 p-6 bg-slate-900 flex flex-col relative">
            <div class="flex items-center justify-between mb-4">
                <span class="text-xs font-semibold uppercase tracking-wider text-slate-500">格式化结果</span>
                <div id="statusIndicator" class="hidden flex items-center gap-2">
                    <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                    <span class="text-[10px] text-blue-400 font-bold uppercase">AI 正在思考...</span>
                </div>
            </div>
            <div id="outputContainer" class="flex-1 overflow-auto">
                <pre id="outputCode" class="code-font text-sm text-blue-100 whitespace-pre-wrap"></pre>
            </div>
            
            <!-- 复制按钮 -->
            <button id="copyBtn" onclick="copyResult()" class="absolute bottom-6 right-6 p-3 bg-white/10 hover:bg-white/20 text-white rounded-xl transition-all border border-white/10 backdrop-blur-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="Page-8 8H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2m4-2V4a2 2 0 00-2-2H9a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- 底部说明 -->
    <div class="mt-8 text-slate-400 text-[10px] uppercase tracking-widest font-medium">
        Powered by DeepSeek & Cloudflare Workers
    </div>

    <script>
        const inputEl = document.getElementById('inputCode');
        const outputEl = document.getElementById('outputCode');
        const statusEl = document.getElementById('statusIndicator');
        let debounceTimer;

        // 监听输入，实时触发（防抖处理）
        inputEl.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            if (!inputEl.value.trim()) {
                outputEl.innerText = "";
                return;
            }
            debounceTimer = setTimeout(formatCode, 1000); // 停止输入1秒后触发
        });

        async function formatCode() {
            const code = inputEl.value;
            statusEl.classList.remove('hidden');

            try {
                const response = await fetch('/api/format', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });

                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                // 移除 AI 自动生成的 Markdown 代码块标记
                const cleanCode = data.result.replace(/```[a-z]*\n?|```/gi, '').trim();
                outputEl.innerText = cleanCode;
            } catch (error) {
                outputEl.innerText = "Error: " + error.message;
            } finally {
                statusEl.classList.add('hidden');
            }
        }

        function copyResult() {
            const text = outputEl.innerText;
            if (!text) return;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const btn = document.getElementById('copyBtn');
            const originalInner = btn.innerHTML;
            btn.innerHTML = '<span class="text-[10px] font-bold">已复制!</span>';
            setTimeout(() => btn.innerHTML = originalInner, 2000);
        }
    </script>
</body>
</html>